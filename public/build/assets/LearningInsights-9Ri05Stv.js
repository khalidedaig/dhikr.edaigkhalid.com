import{r as v,c as S,o as G,a as c,b as g,e as a,j as f,n as w,t as m,y as P,f as B,F as O,h as A}from"./app-BAKlbPj6.js";class R{constructor(){this.storageKey="dhikr-learning-data",this.sessionsKey="dhikr-sessions",this.init()}init(){if(!localStorage.getItem(this.storageKey)){const t={preferences:{favoriteTimeSlots:[],preferredGoals:{},completionPatterns:{}},analytics:{totalSessions:0,totalCounts:0,averageSessionDuration:0,streakDays:0,lastActiveDate:null},recommendations:{suggestedGoals:{},preferredDhikr:[],nextSessionTime:null},insights:{bestPerformingTimes:[],consistencyScore:0,improvementAreas:[]}};localStorage.setItem(this.storageKey,JSON.stringify(t))}}recordSession(t,e,s,r,n){this.getLearningData();const d={dhikrId:t,count:e,goal:s,completed:e>=s,startTime:r,endTime:n,duration:n-r,timeOfDay:new Date(r).getHours(),dayOfWeek:new Date(r).getDay(),timestamp:Date.now()},l=this.getSessions();l.push(d),this.saveSessions(l),this.updateAnalytics(d),this.updatePreferences(d),this.generateRecommendations()}recordInteraction(t,e=null,s={}){const r={type:t,dhikrId:e,timestamp:Date.now(),timeOfDay:new Date().getHours(),...s},n=this.getLearningData();n.interactions||(n.interactions=[]),n.interactions.push(r),n.interactions.length>1e3&&(n.interactions=n.interactions.slice(-1e3)),this.saveLearningData(n),this.learnFromInteraction(r)}learnFromInteraction(t){const e=this.getLearningData();switch(t.type){case"goal_change":this.learnGoalPreferences(t,e);break;case"dhikr_select":this.learnDhikrPreferences(t,e);break;case"time_preference":this.learnTimePreferences(t,e);break}this.saveLearningData(e)}learnGoalPreferences(t,e){const{dhikrId:s,newGoal:r,oldGoal:n}=t;e.preferences.preferredGoals[s]||(e.preferences.preferredGoals[s]=[]),e.preferences.preferredGoals[s].push({goal:r,timestamp:Date.now(),context:{timeOfDay:new Date().getHours(),previousGoal:n}}),e.preferences.preferredGoals[s].length>10&&(e.preferences.preferredGoals[s]=e.preferences.preferredGoals[s].slice(-10))}learnDhikrPreferences(t,e){const{dhikrId:s}=t,r=new Date().getHours();e.preferences.dhikrByTime||(e.preferences.dhikrByTime={});const n=this.getTimeSlot(r);e.preferences.dhikrByTime[n]||(e.preferences.dhikrByTime[n]={}),e.preferences.dhikrByTime[n][s]||(e.preferences.dhikrByTime[n][s]=0),e.preferences.dhikrByTime[n][s]++}updateAnalytics(t){const e=this.getLearningData(),s=e.analytics;s.totalSessions++,s.totalCounts+=t.count,s.averageSessionDuration=(s.averageSessionDuration*(s.totalSessions-1)+t.duration)/s.totalSessions,this.updateStreak(t.startTime,s),s.lastActiveDate=new Date(t.startTime).toDateString(),this.saveLearningData(e)}updatePreferences(t){const e=this.getLearningData(),s=this.getTimeSlot(new Date(t.startTime).getHours());e.preferences.favoriteTimeSlots.includes(s)||e.preferences.favoriteTimeSlots.push(s),e.preferences.completionPatterns[t.dhikrId]||(e.preferences.completionPatterns[t.dhikrId]={attempts:0,completions:0,averageCount:0});const r=e.preferences.completionPatterns[t.dhikrId];r.attempts++,t.completed&&r.completions++,r.averageCount=(r.averageCount*(r.attempts-1)+t.count)/r.attempts,this.saveLearningData(e)}generateRecommendations(){const t=this.getLearningData(),e=this.getSessions();this.generateGoalRecommendations(t,e),this.generateDhikrRecommendations(t),this.generateTimeRecommendations(t,e),this.saveLearningData(t)}generateGoalRecommendations(t,e){const s={};e.forEach(r=>{s[r.dhikrId]||(s[r.dhikrId]={attempts:0,completions:0,averageCompletion:0});const n=s[r.dhikrId];n.attempts++,r.completed&&n.completions++,n.averageCompletion=(n.averageCompletion*(n.attempts-1)+r.count/r.goal)/n.attempts}),Object.keys(s).forEach(r=>{const n=s[r];if(n.attempts>=3){const d=n.completions/n.attempts;if(d<.6){const l=e.filter(u=>u.dhikrId===r).slice(-5),p=l.reduce((u,k)=>u+k.count,0)/l.length;t.recommendations.suggestedGoals[r]=Math.ceil(p*1.2)}else if(d>.9){const l=e.filter(u=>u.dhikrId===r).slice(-3),p=l.reduce((u,k)=>u+k.goal,0)/l.length;t.recommendations.suggestedGoals[r]=Math.ceil(p*1.3)}}})}getPersonalizedInsights(){const t=this.getLearningData(),e=this.getSessions();return{consistency:this.calculateConsistencyScore(e),bestTime:this.getBestPerformingTime(e),improvement:this.getImprovementSuggestions(t,e),streakInfo:{current:t.analytics.streakDays,longest:this.getLongestStreak(e)},favoritesDhikr:this.getMostUsedDhikr(e),goalOptimization:this.getGoalOptimizationTips(t,e)}}getTimeSlot(t){return t>=5&&t<12?"morning":t>=12&&t<17?"afternoon":t>=17&&t<21?"evening":"night"}updateStreak(t,e){const s=new Date(t).toDateString(),r=new Date(Date.now()-864e5).toDateString();e.lastActiveDate===r||e.lastActiveDate===s?e.lastActiveDate!==s&&e.streakDays++:e.lastActiveDate!==s&&(e.streakDays=1)}calculateConsistencyScore(t){if(t.length<7)return 0;const e=t.filter(r=>Date.now()-r.timestamp<=7*24*60*60*1e3),s=new Set(e.map(r=>new Date(r.timestamp).toDateString())).size;return Math.round(s/7*100)}getMostUsedDhikr(t){const e={};return t.forEach(s=>{e[s.dhikrId]=(e[s.dhikrId]||0)+1}),Object.entries(e).sort(([,s],[,r])=>r-s).slice(0,3).map(([s,r])=>({dhikrId:s,count:r}))}getLearningData(){const t=localStorage.getItem(this.storageKey);return t?JSON.parse(t):null}saveLearningData(t){localStorage.setItem(this.storageKey,JSON.stringify(t))}getSessions(){const t=localStorage.getItem(this.sessionsKey);return t?JSON.parse(t):[]}saveSessions(t){const e=t.slice(-500);localStorage.setItem(this.sessionsKey,JSON.stringify(e))}getCurrentRecommendation(){const t=this.getLearningData(),e=this.getTimeSlot(new Date().getHours());if(t.preferences.dhikrByTime&&t.preferences.dhikrByTime[e]){const s=Object.entries(t.preferences.dhikrByTime[e]).sort(([,r],[,n])=>n-r);if(s.length>0)return{dhikrId:s[0][0],confidence:s[0][1]/10,reason:`You often practice this dhikr during ${e}`}}return null}getSuggestedGoal(t){const e=this.getLearningData();return e.recommendations.suggestedGoals[t]?{goal:e.recommendations.suggestedGoals[t],reason:"Based on your completion patterns"}:null}resetLearningData(){localStorage.removeItem(this.storageKey),localStorage.removeItem(this.sessionsKey),this.init()}}const y=new R,K={class:"bg-gradient-to-br from-purple-50 to-blue-50 dark:from-purple-900 dark:to-blue-900 rounded-lg p-6 mb-6"},N={key:0,class:"text-center py-4"},z={key:1,class:"space-y-4"},j={key:0,class:"bg-white dark:bg-gray-800 rounded-lg p-4"},M={class:"flex items-center justify-between mb-2"},E={class:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2"},H={key:1,class:"bg-white dark:bg-gray-800 rounded-lg p-4 border-l-4 border-green-500"},$={class:"text-sm text-gray-600 dark:text-gray-400 mb-2"},F={key:2,class:"bg-white dark:bg-gray-800 rounded-lg p-4 border-l-4 border-blue-500"},J={class:"text-sm text-gray-600 dark:text-gray-400 mb-2"},V={class:"flex items-center space-x-2"},q={class:"font-bold text-blue-600 dark:text-blue-400"},U={key:3,class:"bg-white dark:bg-gray-800 rounded-lg p-4"},Y={class:"grid grid-cols-2 gap-4"},W={class:"text-center"},Q={class:"text-2xl font-bold text-orange-500 dark:text-orange-400"},X={class:"text-center"},Z={class:"text-2xl font-bold text-red-500 dark:text-red-400"},ee={key:4,class:"bg-white dark:bg-gray-800 rounded-lg p-4"},te={class:"text-sm text-gray-600 dark:text-gray-400"},se={class:"font-medium text-indigo-600 dark:text-indigo-400"},re={key:5,class:"bg-white dark:bg-gray-800 rounded-lg p-4"},ne={class:"space-y-2"},ae={class:"text-sm text-gray-600 dark:text-gray-400"},oe={class:"flex items-center space-x-1"},ie={class:"text-xs text-gray-500 dark:text-gray-400"},le={key:0,class:"text-yellow-500"},ce={class:"text-center pt-2"},ge={key:0,class:"mt-2 space-y-2 text-xs"},ue={__name:"LearningInsights",props:{currentDhikrId:{type:[String,Number],default:null},dhikrList:{type:Array,default:()=>[]}},emits:["apply-goal","apply-recommendation"],setup(D,{expose:t,emit:e}){const s=e,r=D,n=v({}),d=v(null),l=v(null),p=v(!1),u=v(!1),k=S(()=>{const i=n.value.consistency||0;return i>=80?"text-green-500":i>=60?"text-yellow-500":i>=40?"text-orange-500":"text-red-500"}),_=S(()=>{const i=n.value.consistency||0;return i>=80?"bg-green-500":i>=60?"bg-yellow-500":i>=40?"bg-orange-500":"bg-red-500"});G(()=>{x()});function x(){try{n.value=y.getPersonalizedInsights();const i=y.getSessions();p.value=i.length>=5,d.value=y.getCurrentRecommendation(),r.currentDhikrId&&(l.value=y.getSuggestedGoal(r.currentDhikrId))}catch(i){console.error("Error loading insights:",i),p.value=!1}}function b(){y.generateRecommendations(),x()}function I(i){s("apply-recommendation",i)}function C(i){const o=r.dhikrList.find(h=>h.id==i);return o?o.transliteration:`Dhikr ${i}`}function T(){confirm("Are you sure you want to reset all learning data? This action cannot be undone.")&&(y.resetLearningData(),n.value={},d.value=null,l.value=null,p.value=!1,u.value=!1)}return t({refreshInsights:b,loadInsights:x}),(i,o)=>(g(),c("div",K,[a("div",{class:"flex items-center justify-between mb-4"},[o[3]||(o[3]=a("h3",{class:"text-lg font-semibold text-purple-800 dark:text-purple-200"}," 🤖 Personal Insights ",-1)),a("button",{onClick:b,class:"text-sm text-purple-600 dark:text-purple-300 hover:text-purple-800 dark:hover:text-purple-100"}," 🔄 Refresh ")]),p.value?(g(),c("div",z,[n.value.consistency!==void 0?(g(),c("div",j,[a("div",M,[o[5]||(o[5]=a("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"}," Consistency Score ",-1)),a("span",{class:w(["text-lg font-bold",k.value])},m(n.value.consistency)+"% ",3)]),a("div",E,[a("div",{class:w(["h-2 rounded-full transition-all duration-500",_.value]),style:P({width:n.value.consistency+"%"})},null,6)])])):f("",!0),d.value?(g(),c("div",H,[o[6]||(o[6]=a("h4",{class:"font-medium text-gray-800 dark:text-gray-200 mb-2"}," 💡 Smart Suggestion ",-1)),a("p",$,m(d.value.reason),1),a("button",{onClick:o[0]||(o[0]=h=>I(d.value)),class:"text-sm bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded transition-colors"}," Apply Suggestion ")])):f("",!0),l.value?(g(),c("div",F,[o[8]||(o[8]=a("h4",{class:"font-medium text-gray-800 dark:text-gray-200 mb-2"}," 🎯 Goal Optimization ",-1)),a("p",J,m(l.value.reason),1),a("div",V,[o[7]||(o[7]=a("span",{class:"text-sm text-gray-600 dark:text-gray-400"}," Suggested goal: ",-1)),a("span",q,m(l.value.goal),1),a("button",{onClick:o[1]||(o[1]=h=>i.$emit("apply-goal",l.value.goal)),class:"text-sm bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded transition-colors"}," Apply ")])])):f("",!0),n.value.streakInfo?(g(),c("div",U,[o[11]||(o[11]=a("h4",{class:"font-medium text-gray-800 dark:text-gray-200 mb-3"}," 🔥 Practice Streak ",-1)),a("div",Y,[a("div",W,[a("div",Q,m(n.value.streakInfo.current),1),o[9]||(o[9]=a("div",{class:"text-xs text-gray-500 dark:text-gray-400"}," Current Streak ",-1))]),a("div",X,[a("div",Z,m(n.value.streakInfo.longest),1),o[10]||(o[10]=a("div",{class:"text-xs text-gray-500 dark:text-gray-400"}," Best Streak ",-1))])])])):f("",!0),n.value.bestTime?(g(),c("div",ee,[o[13]||(o[13]=a("h4",{class:"font-medium text-gray-800 dark:text-gray-200 mb-2"}," ⏰ Best Performance Time ",-1)),a("p",te,[o[12]||(o[12]=B(" You complete dhikr most successfully during ")),a("span",se,m(n.value.bestTime),1)])])):f("",!0),n.value.favoritesDhikr&&n.value.favoritesDhikr.length>0?(g(),c("div",re,[o[14]||(o[14]=a("h4",{class:"font-medium text-gray-800 dark:text-gray-200 mb-3"}," 💝 Most Practiced ",-1)),a("div",ne,[(g(!0),c(O,null,A(n.value.favoritesDhikr.slice(0,3),(h,L)=>(g(),c("div",{key:h.dhikrId,class:"flex items-center justify-between"},[a("span",ae,m(C(h.dhikrId)),1),a("div",oe,[a("span",ie,m(h.count)+" times ",1),L===0?(g(),c("span",le," 👑 ")):f("",!0)])]))),128))])])):f("",!0),a("div",ce,[a("button",{onClick:o[2]||(o[2]=h=>u.value=!u.value),class:"text-xs text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"}," 🔒 Privacy & Data Controls "),u.value?(g(),c("div",ge,[o[15]||(o[15]=a("p",{class:"text-gray-500 dark:text-gray-400"}," All data is stored locally on your device. No information is sent to external servers. ",-1)),a("button",{onClick:T,class:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded transition-colors"}," Reset Learning Data ")])):f("",!0)])])):(g(),c("div",N,o[4]||(o[4]=[a("p",{class:"text-purple-600 dark:text-purple-300 text-sm"}," Keep practicing to unlock personalized insights! Complete a few more dhikr sessions to see recommendations. ",-1)])))]))}};export{ue as _,y as l};
